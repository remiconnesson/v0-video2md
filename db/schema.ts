import {
  boolean,
  index,
  integer,
  jsonb,
  pgTable,
  serial,
  text,
  timestamp,
  unique,
  varchar,
} from "drizzle-orm/pg-core";

export const channels = pgTable("channels", {
  channelId: varchar("channel_id", { length: 64 }).primaryKey(),
  channelName: text("channel_name").notNull(),
});

export const videos = pgTable(
  "videos",
  {
    videoId: varchar("video_id", { length: 32 }).primaryKey(),
    url: text("url").notNull(),
    title: text("title").notNull(),
    publishedAt: timestamp("published_at", { withTimezone: true }),
    channelId: varchar("channel_id", { length: 64 })
      .notNull()
      .references(() => channels.channelId, {
        onDelete: "cascade",
        onUpdate: "cascade",
      }),
  },
  (table) => [index("videos_channel_id_idx").on(table.channelId)]
);

export const scrapTranscriptV1 = pgTable(
  "scrap_transcript_v1",
  {
    id: serial("id").primaryKey(),
    videoId: varchar("video_id", { length: 32 })
      .notNull()
      .references(() => videos.videoId, { onDelete: "cascade" }),
    channelId: varchar("channel_id", { length: 64 })
      .notNull()
      .references(() => channels.channelId, { onDelete: "cascade" }),
    description: text("description"),
    subscriberCount: integer("subscriber_count"),
    viewCount: integer("view_count"),
    likeCount: integer("like_count"),
    durationSeconds: integer("duration_seconds"),
    isAutoGenerated: boolean("is_auto_generated"),
    thumbnail: text("thumbnail"),
    transcript: jsonb("transcript"),
    createdAt: timestamp("created_at").defaultNow(),
  },
  (table) => [unique("unique_video_transcript").on(table.videoId)]
);
